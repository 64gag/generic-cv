<%-
  require 'i18n'
  require "i18n/backend/fallbacks"
  I18n::Backend::Simple.send(:include, I18n::Backend::Fallbacks)

  I18n.load_path << Dir[File.expand_path("locales") + "/*.yml"]
  I18n.default_locale = :CV_LOCALE
  I18n.fallbacks.map(:CV_LOCALE => :common)

  def generate_section_content(section:)
    text = ''
    text += "\\ecvsection{#{I18n.t("#{section}.section_name")}}"

    I18n.t("#{section}.categories").each do |category|
      text += "\\ecvitem[10pt]{#{category[:name]}} {"
      category[:entries].each do |entry|
        unless entry[:details].empty?
          text += "\\textbf{- #{entry[:name]}:} #{entry[:details]}\\par"
        else
          text += "\\textbf{- #{entry[:name]}.}\\par"
        end
      end

      text += "}"
    end

    text
  end
  def str2ecv(str)
    case str
    when "A1"
      '\ecvAOne'
    when "A2"
      '\ecvATwo'
    when "B1"
      '\ecvBOne'
    when "B2"
      '\ecvBTwo'
    when "C1"
      '\ecvCOne'
    when "C2"
      '\ecvCTwo'
    end
  end
-%>
\documentclass[helvetica,<%= I18n.t('ecv.language') -%>,logo,notitle,totpages,utf8]{europecv2013}
\usepackage{graphicx}
\usepackage[a4paper,top=1.2cm,left=1.2cm,right=1.2cm,bottom=2.5cm]{geometry}
\usepackage[<%= I18n.t('ecv.language') -%>]{babel}
\usepackage[T1]{fontenc}
\usepackage{ifpdf}
\usepackage{url}
\usepackage{hyperref}
\usepackage{graphicx}

\ecvlastname{<%= I18n.t('contact.name.last') %>}
\ecvfirstname{<%= I18n.t('contact.name.first') %>}
\ecvaddress{<%= I18n.t('contact.address') %>}
\ecvtelephone[<%= I18n.t('contact.phone.landline') %>]{<%= I18n.t('contact.phone.mobile') %>}
\ecvemail{<%= I18n.t('contact.email') %>}
\ecvnationality{<%= I18n.t('personal.nationality') %>}
\ecvdateofbirth{<%= I18n.t('personal.date_of_birth') %>}
\ecvgender{<%= I18n.t('personal.gender') %>}
\ecvpicture[width=2cm]{picture.png}

\ecvfootnote{<%= I18n.t('ecv.footnote') %> | \href{http://europass.cedefop.europa.eu}{http://europass.cedefop.europa.eu}}

\begin{document}
\selectlanguage{<%= I18n.t('ecv.language') %>}

\begin{europecv}
\ecvpersonalinfo[10pt]

\ecvposition{<%= I18n.t('position.section_name') %>}{<%= I18n.t('position.name') %>}

% ----------------------------------------------------------------- %

\ecvsection{<%= I18n.t('professional.section_name') %>}

<%- I18n.t('professional.entries').each do |pro_entry| -%>

  \ecvworkexperience{<%= pro_entry[:date] %>}{<%= pro_entry[:position] %>}{<%= pro_entry[:organization] %>}{\href{<%= pro_entry[:url] %>}{<%= pro_entry[:url] %>}}
  {<%= pro_entry[:description] %>}

<%- end -%>

% ----------------------------------------------------------------- %

\ecvsection{<%= I18n.t('education.section_name') %>}

<%- I18n.t('education.entries').each do |ed_entry| -%>

  \ecveducation{<%= ed_entry[:date] %>}{<%= ed_entry[:program] %>}{<%= ed_entry[:institution] %>}
  {}{<%= ed_entry[:extra] %>}

<%- end -%>

% ----------------------------------------------------------------- %


\ecvsection{<%= I18n.t('languages.section_name') %>}

<%-
  languages_entries = I18n.t('languages.entries').dup
  mother_tongues = languages_entries.keep_if {|e| e[:mother_tongue]}
  mother_tongues_str = mother_tongues.map {|m| m[:name]}.join(", ")
-%>
  \ecvmothertongue[20pt]{<%= mother_tongues_str %> }

<%-
  languages_entries = I18n.t('languages.entries').dup
  non_mother_tongues = languages_entries.keep_if {|e| not e[:mother_tongue]}
-%>

\ecvlanguageheader
<%- non_mother_tongues.each do |entry| -%>

  \ecvlanguage{<%= entry[:name] %>}
  {<%= str2ecv(entry[:level_understanding_listening]) %>}
  {<%= str2ecv(entry[:level_understanding_reading]) %>}
  {<%= str2ecv(entry[:level_speaking_interaction]) %>}
  {<%= str2ecv(entry[:level_speaking_production]) %>}
  {<%= str2ecv(entry[:level_writing_user]) %>}

<%- end -%>

\ecvlanguagefooter[10pt]

% ----------------------------------------------------------------- %

<%= generate_section_content(section: 'skills') -%>

<%= generate_section_content(section: 'additional') -%>

\end{europecv}
\end{document}
